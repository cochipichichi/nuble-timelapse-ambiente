<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🛰️ Timelapse Ñuble (MODIS + S2)</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="../assets/js/config.js"></script>
</head>
<body class="fullscreen">
  <div class="toolbar">
    <div class="title">🛰️ Timelapse Ñuble</div>
    <div class="controls">
      <button class="toggle" data-toggle="hc">🌓 Alto contraste</button>
      <a class="toggle" href="../index.html">↩️ Volver</a>
      <a class="toggle" href="./evidencias.html">🪄 Evidencias</a>
    </div>
  </div>
  <div class="mapwrap">
    <div id="map"></div>
    <div class="slider">
      <span class="label">Año</span>
      <input id="year" type="range" min="2001" max="2025" value="2001" step="1">
      <strong id="ylab">2001</strong>
    </div>
  </div>
<script src="../assets/js/shared.js"></script>
<script src="../assets/js/logros.js"></script>
<script>
const map = L.map('map',{zoomControl:true}).setView([-36.72, -72.3], 8);
const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'© OpenStreetMap'}).addTo(map);
let gibsLayer;
const templ = (dateStr)=> `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/${dateStr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`;
function setYear(y){
  const d = `${y}-07-01`;
  if(gibsLayer) map.removeLayer(gibsLayer);
  gibsLayer = L.tileLayer(templ(d), { attribution:'NASA GIBS / MODIS', maxZoom:9, opacity:0.92 }).addTo(map);
  document.getElementById('ylab').textContent = y;
}
setYear(2001);
document.getElementById('year').addEventListener('input', e=> setYear(e.target.value));
const s2 = L.tileLayer(window.NUBLE_LAYERS.s2cloudless, {attribution:'EOX S2 Cloudless', opacity:.9});
const worldCover = L.tileLayer(window.NUBLE_LAYERS.worldcover, {attribution:'WorldCover (placeholder)', opacity:.6});
L.control.layers({"🗺️ OSM":osm},{"🛰️ MODIS (anual)":gibsLayer,"🛰️ S2 Cloudless":s2,"🗺️ WorldCover":worldCover}).addTo(map);
Logros.set(Logros.keys.TIMELAPSE);
</script>
</body>
</html>
