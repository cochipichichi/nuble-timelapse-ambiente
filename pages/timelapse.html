<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🛰️ Timelapse Ñuble (MODIS GIBS)</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="fullscreen">
  <div class="toolbar">
    <div class="title">🛰️ Timelapse Ñuble</div>
    <div class="controls">
      <button class="toggle" data-toggle="hc">🌓 Alto contraste</button>
      <a class="toggle" href="../index.html">↩️ Volver</a>
    </div>
  </div>
  <div class="mapwrap">
    <div id="map" aria-label="Mapa timelapse"></div>
    <div class="slider" role="group" aria-label="Control de año">
      <span class="label">Año</span>
      <input id="year" type="range" min="2001" max="2025" value="2001" step="1" aria-valuemin="2001" aria-valuemax="2025" aria-valuenow="2001">
      <strong id="ylab">2001</strong>
    </div>
  </div>

<script src="../assets/js/shared.js"></script>
<script>
// Leaflet map
const map = L.map('map',{zoomControl:true}).setView([-36.72, -72.3], 8);

// Base map (OSM)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19, attribution:'© OpenStreetMap'
}).addTo(map);

// NASA GIBS MODIS Terra Corrected Reflectance (True Color) via WMTS
// We'll request a fixed date each year (e.g., 01-15) to approximate a time-slice.
let gibsLayer;
const templ = (datestr)=> `https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/${datestr}/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg`;

function setYear(y){
  const datestr = `${y}-07-01`; // mid-year snapshot to reduce seasonal variation
  const url = templ(datestr);
  if(gibsLayer){ map.removeLayer(gibsLayer); }
  gibsLayer = L.tileLayer(url, {
    attribution: 'NASA GIBS / MODIS Terra',
    maxZoom: 9, // GIBS Level 9 limit for this layer
    opacity: 0.92
  }).addTo(map);
  document.getElementById('ylab').textContent = y;
}
setYear(2001);

document.getElementById('year').addEventListener('input', (e)=>{
  setYear(e.target.value);
});
</script>
</body>
</html>
